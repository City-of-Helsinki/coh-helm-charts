{{- $redisPort := 6379 }}
{{- $sentinelPort := 26379 }}
{{- $masterName := "mymaster" }}
{{- if .Values.redis }}
{{- if .Values.redis.config }}
{{- $redisPort = .Values.redis.config.port | default $redisPort }}
{{- end }}
{{- end }}
{{- if .Values.sentinel }}
{{- if .Values.sentinel.config }}
{{- $sentinelPort = .Values.sentinel.config.port | default $sentinelPort }}
{{- $masterName = .Values.sentinel.config.masterName | default $masterName }}
{{- end }}
{{- end }}
Redis Sentinel has been deployed!

{{- if .Values.redis.password.existingSecret }}
1. Using existing secret: {{ .Values.redis.password.existingSecret }}
   Password key: {{ .Values.redis.password.secretKey }}
{{- else }}
1. Generated Redis password:
   kubectl get secret {{ include "redis-sentinel.redis.passwordSecret" . }} -n {{ .Release.Namespace }} -o jsonpath="{.data.{{ include "redis-sentinel.redis.passwordKey" . }}}" | base64 --decode && echo
{{- end }}

2. Connect to Redis:
   kubectl exec -it {{ include "redis-sentinel.fullname" . }}-redis-0 -n {{ .Release.Namespace }} -- redis-cli -a $REDIS_PASSWORD

3. Connect to Sentinel:
   kubectl exec -it {{ include "redis-sentinel.fullname" . }}-sentinel-0 -n {{ .Release.Namespace }} -- redis-cli -p {{ $sentinelPort }} -a $REDIS_PASSWORD

4. Check Sentinel info:
   kubectl exec -it {{ include "redis-sentinel.fullname" . }}-sentinel-0 -n {{ .Release.Namespace }} -- redis-cli -p {{ $sentinelPort }} -a $REDIS_PASSWORD sentinel masters

5. Services:
   Redis: {{ include "redis-sentinel.fullname" . }}-headless:{{ $redisPort }}
   Sentinel: {{ include "redis-sentinel.fullname" . }}-sentinel:{{ $sentinelPort }}

For Drupal configuration, use:
   $settings['redis.connection']['host'] = ['{{ include "redis-sentinel.fullname" . }}-sentinel:{{ $sentinelPort }}']
   $settings['redis.connection']['instance'] = '{{ $masterName }}'