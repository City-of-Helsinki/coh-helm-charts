# Default values for redis-sentinel chart
# This is a YAML-formatted file with all available configuration options

# Global pod security context
# These settings apply at the pod level
podSecurityContext:
  enabled: false
  runAsUser: "1000930000"
  runAsGroup: "1000930000"
  fsGroup: "1000930000"
  fsGroupChangePolicy: "OnRootMismatch"

# Redis Configuration
redis:
  # Number of Redis instances (1 master + N-1 replicas)
  replicaCount: 3
  
  # Redis container image
  # If not specified, uses default from _helpers.tpl
  image: ""  # defaults to registry.redhat.io/rhel9/redis-7@sha256:3d31c0cfaf4219f5bd1c52882b603215d1cb4aaef5b8d1a128d0174e090f96f3
  
  # Container-level security context for Redis pods
  # Set enabled: true to override pod-level security context
  securityContext:
    enabled: false
    # runAsUser: 1000930000
    # runAsGroup: 1000930000
    # runAsNonRoot: true
    # readOnlyRootFilesystem: true
    # allowPrivilegeEscalation: false
    # capabilities:
    #   drop:
    #     - ALL
  
  # Resource limits and requests for Redis containers
  resources:
    limits:
      memory: "1Gi"
      # cpu: "1000m"  # Uncomment to set CPU limit
    requests:
      cpu: "50m"
      memory: "512Mi"
  
  # Persistent storage configuration
  persistence:
    enabled: false
    size: 10Gi
    storageClass: ""  # Use cluster default storage class
    mountPath: "/data"
  
  # Password configuration
  password:
    # Auto-generate password if not specified
    password: ""
    
    # Use existing secret instead of creating new one
    # If specified, password field above is ignored
    existingSecret: ""
    
    # Key name in the secret containing the password
    secretKey: "REDIS_PASSWORD"
  
  # Pod Disruption Budget
  pdb:
    enabled: true
    minAvailable: 1
    # maxUnavailable: 1  # Alternative to minAvailable
    annotations: {}
  
  # Service configuration
  service:
    port: 6379
    targetPort: 6379
  
  # Base Redis configuration
  # These are the default values that will be used
  config:
    # Network settings
    bind: "0.0.0.0"
    protectedMode: "yes"
    port: 6379
    timeout: "500"
    tcpKeepalive: "300"
    tcpBacklog: "511"
    
    # Authentication
    requirepass: ""  # Will be set from password secret
    
    # Daemon settings
    daemonize: "no"
    supervised: "no"
    pidfile: "/var/run/redis_6379.pid"
    
    # Logging
    loglevel: "notice"
    logfile: ""
    
    # Database
    databases: "16"
    
    # Memory management
    maxmemory: "900mb"
    maxmemoryPolicy: "allkeys-lru"
    
    # Persistence
    save: ""  # Disable RDB snapshots (empty string)
    appendonly: "no"
    stopWritesOnBgsaveError: "no"
    rdbcompression: "yes"
    rdbchecksum: "yes"
    rdbDelSyncFiles: "no"
    
    # Replication
    replicaServeStaleData: "yes"
    replicaReadOnly: "yes"
    replDisklessSync: "no"
    replDisklessSyncDelay: "5"
    replDisklessLoad: "disabled"
    replDisableTcpNodelay: "no"
    replicaPriority: "100"
    
    # ACL
    acllogMaxLen: "128"
    
    # Miscellaneous
    alwaysShowLogo: "yes"
    dir: "/data"
  
  # Extra configuration to override or extend base config
  # These values will override the base config above
  extraConfig: {}
    # Example overrides:
    # maxmemory: "2gb"
    # maxmemory-policy: "volatile-lru"
    # slowlog-log-slower-than: "10000"
    # slowlog-max-len: "128"
    # notify-keyspace-events: "Ex"
    # tcp-backlog: "1024"
    # save: "900 1 300 10 60 10000"  # Enable RDB
    # appendonly: "yes"  # Enable AOF

# Sentinel Configuration
sentinel:
  enabled: true
  
  # Number of Sentinel instances (always use odd numbers: 3, 5, 7)
  replicaCount: 3
  
  # Sentinel container image
  # If not specified, uses default from _helpers.tpl
  image: "" # defaults to registry.redhat.io/rhel9/redis-7@sha256:3d31c0cfaf4219f5bd1c52882b603215d1cb4aaef5b8d1a128d0174e090f96f3
  
  # Container-level security context for Sentinel pods
  # Set enabled: true to override pod-level security context
  securityContext:
    enabled: false
    # runAsUser: 1000930000
    # runAsGroup: 1000930000
    # runAsNonRoot: true
    # readOnlyRootFilesystem: true
    # allowPrivilegeEscalation: false
  
  # Resource limits and requests for Sentinel containers
  resources:
    limits:
      memory: "200Mi"
      # cpu: "500m"  # Uncomment to set CPU limit
    requests:
      cpu: "50m"
      memory: "20Mi"
  
  # Pod Disruption Budget
  pdb:
    enabled: true
    minAvailable: 1
    # maxUnavailable: 1  # Alternative to minAvailable
    annotations: {}
  
  # Service configuration
  service:
    type: ClusterIP
    port: 26379  # External port for clients
    targetPort: 26379  # Sentinel port inside container
  
  # Base Sentinel configuration
  config:
    # Sentinel port
    port: 26379
    
    # Master name to monitor
    masterName: "mymaster"
    
    # Number of Sentinels that must agree master is down
    # Should be: (total_sentinels / 2) + 1
    # For 3 sentinels: quorum = 2
    # For 5 sentinels: quorum = 3
    quorum: 2
    
    # Time in milliseconds before marking master as down
    # Increase this value if you have network latency
    downAfterMilliseconds: 5000
    
    # Maximum time for failover process
    failoverTimeout: 10000
    
    # Number of replicas to reconfigure in parallel during failover
    # Keep at 1 to minimize load during failover
    parallelSyncs: 1
    
    # Hostname resolution (required for openshift)
    resolveHostnames: "yes"
    announceHostnames: "yes"
  
  # Extra configuration to override or extend base config
  # These values will override the base config above
  extraConfig: {}
    # Example overrides:
    # sentinel down-after-milliseconds mymaster: "10000"
    # sentinel failover-timeout mymaster: "20000"
    # sentinel parallel-syncs mymaster: "2"
    # sentinel deny-scripts-reconfig: "yes"

# Pod scheduling configuration

# Node selector for pod assignment
# Example: deploy only on nodes with label workload=redis
nodeSelector: {}
  # workload: redis
  # disktype: ssd

# Pod anti-affinity configuration
# Spreads Redis and Sentinel pods across different nodes
affinity:
  enabled: true
  # When enabled, uses preferredDuringSchedulingIgnoredDuringExecution
  # This is a soft rule - pods will still schedule if not enough nodes
  # For hard rule, modify the StatefulSet templates directly

# Tolerations for pod assignment
# Example: allow pods on nodes with redis taint
tolerations: []
  # - key: "redis"
  #   operator: "Equal"
  #   value: "true"
  #   effect: "NoSchedule"
  # - key: "high-memory"
  #   operator: "Exists"
  #   effect: "NoSchedule"

# Probe configuration for health checks
probes:
  redis:
    liveness:
      initialDelaySeconds: 10
      timeoutSeconds: 5
      periodSeconds: 5
      failureThreshold: 10
      successThreshold: 1
    readiness:
      initialDelaySeconds: 5
      timeoutSeconds: 15
      periodSeconds: 2
      successThreshold: 2
      failureThreshold: 40
  
  sentinel:
    liveness:
      initialDelaySeconds: 10
      timeoutSeconds: 5
      periodSeconds: 5
      failureThreshold: 10
      successThreshold: 1
    readiness:
      initialDelaySeconds: 5
      timeoutSeconds: 10
      periodSeconds: 2
      successThreshold: 1
      failureThreshold: 20

# Helm chart metadata (read-only, for reference)
# These values are set in Chart.yaml
nameOverride: ""
fullnameOverride: ""

# ============================================================================
# CONFIGURATION EXAMPLES FOR DIFFERENT SCENARIOS
# ============================================================================

# Example 1: Development Environment
# -----------------------------------
# redis:
#   replicaCount: 3
#   persistence:
#     enabled: false
#   resources:
#     requests:
#       cpu: 100m
#       memory: 256Mi
#     limits:
#       memory: 512Mi
# sentinel:
#   replicaCount: 3
#   resources:
#     requests:
#       cpu: 50m
#       memory: 128Mi
# affinity:
#   enabled: false

# Example 2: Production Environment
# ----------------------------------
# redis:
#   replicaCount: 3
#   persistence:
#     enabled: true
#     size: 20Gi
#     storageClass: fast-ssd
#   resources:
#     requests:
#       cpu: 500m
#       memory: 1Gi
#     limits:
#       cpu: 2000m
#       memory: 2Gi
#   pdb:
#     enabled: true
#     minAvailable: 2
#   password:
#     existingSecret: redis-prod-secret
#     secretKey: password
# sentinel:
#   replicaCount: 3
#   pdb:
#     enabled: true
#     minAvailable: 2
#   resources:
#     requests:
#       cpu: 100m
#       memory: 256Mi
#     limits:
#       memory: 512Mi
# affinity:
#   enabled: true
# nodeSelector:
#   workload: redis

# Example 3: Cache-Only Configuration
# ------------------------------------
# redis:
#   replicaCount: 3
#   persistence:
#     enabled: false
#   config:
#     maxmemory: "1gb"
#     maxmemory-policy: "allkeys-lru"
#     save: ""
#     appendonly: "no"
#   extraConfig:
#     slowlog-log-slower-than: "10000"
#     notify-keyspace-events: "Ex"
# sentinel:
#   config:
#     downAfterMilliseconds: 3000
#     quorum: 2

# Example 4: High Security
# -------------------------
# podSecurityContext:
#   enabled: true
#   runAsUser: "1000930000"
#   runAsGroup: "1000930000"
#   fsGroup: "1000930000"
#   fsGroupChangePolicy: "OnRootMismatch"
# redis:
#   securityContext:
#     enabled: true
#     runAsNonRoot: true
#     readOnlyRootFilesystem: true
#     allowPrivilegeEscalation: false
#     capabilities:
#       drop:
#         - ALL
#   password:
#     existingSecret: vault-redis-secret
#   extraConfig:
#     protected-mode: "yes"
#     rename-command-CONFIG: ""
# sentinel:
#   securityContext:
#     enabled: true
#     runAsNonRoot: true
#     readOnlyRootFilesystem: true

# Example 5: Persistent Data with Custom Config
# ----------------------------------------------
# redis:
#   replicaCount: 3
#   persistence:
#     enabled: true
#     size: 50Gi
#     storageClass: fast-ssd
#   config:
#     maxmemory: "4gb"
#     maxmemory-policy: "allkeys-lru"
#   extraConfig:
#     save: "900 1 300 10 60 10000"
#     appendonly: "yes"
#     appendfsync: "everysec"
#     auto-aof-rewrite-percentage: "100"
#     auto-aof-rewrite-min-size: "64mb"
#   resources:
#     requests:
#       cpu: 1000m
#       memory: 4Gi
#     limits:
#       cpu: 2000m
#       memory: 5Gi